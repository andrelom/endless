<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Seamless Integration of Sitecore Content Hub With Nextjs Using Reverse Proxy Calls | André Moraes</title><meta name=keywords content="Sitecore,Sitecore Content Hub,Sitecore Content Hub One,Reverse Proxy,GraphQL"><meta name=description content="Reverse proxy calls streamline the integration of Sitecore Content Hub with Next.js, enhancing security and simplifying the process."><meta name=author content="André Moraes"><link rel=canonical href=https://andrelom.github.io/endless/posts/seamless-integration-of-sitecore-content-hub-with-nextjs-using-reverse-proxy-calls/><link crossorigin=anonymous href=/endless/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/endless/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://andrelom.github.io/endless/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://andrelom.github.io/endless/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://andrelom.github.io/endless/favicon-32x32.png><link rel=apple-touch-icon href=https://andrelom.github.io/endless/apple-touch-icon.png><link rel=mask-icon href=https://andrelom.github.io/endless/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Seamless Integration of Sitecore Content Hub With Nextjs Using Reverse Proxy Calls"><meta property="og:description" content="Reverse proxy calls streamline the integration of Sitecore Content Hub with Next.js, enhancing security and simplifying the process."><meta property="og:type" content="article"><meta property="og:url" content="https://andrelom.github.io/endless/posts/seamless-integration-of-sitecore-content-hub-with-nextjs-using-reverse-proxy-calls/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-05-23T03:47:58-03:00"><meta property="article:modified_time" content="2023-05-23T03:47:58-03:00"><meta property="og:site_name" content="Endless"><meta name=twitter:card content="summary"><meta name=twitter:title content="Seamless Integration of Sitecore Content Hub With Nextjs Using Reverse Proxy Calls"><meta name=twitter:description content="Reverse proxy calls streamline the integration of Sitecore Content Hub with Next.js, enhancing security and simplifying the process."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://andrelom.github.io/endless/posts/"},{"@type":"ListItem","position":2,"name":"Seamless Integration of Sitecore Content Hub With Nextjs Using Reverse Proxy Calls","item":"https://andrelom.github.io/endless/posts/seamless-integration-of-sitecore-content-hub-with-nextjs-using-reverse-proxy-calls/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Seamless Integration of Sitecore Content Hub With Nextjs Using Reverse Proxy Calls","name":"Seamless Integration of Sitecore Content Hub With Nextjs Using Reverse Proxy Calls","description":"Reverse proxy calls streamline the integration of Sitecore Content Hub with Next.js, enhancing security and simplifying the process.","keywords":["Sitecore","Sitecore Content Hub","Sitecore Content Hub One","Reverse Proxy","GraphQL"],"articleBody":"Efficient and secure connections between different platforms are crucial in the ever-evolving web development landscape. One such scenario is integrating Sitecore Content Hub with Next.js applications.\nBy utilizing Next.js and implementing reverse proxy calls, developers can optimize communication while safeguarding sensitive information. In this blog post, we’ll explore the benefits of reverse proxy calls and how they enhance security and API protection by concealing the Content Hub endpoint and API token.\nBenefits of Reverse Proxy Calls When integrating Next.js with Sitecore Content Hub, reverse proxy calls offer an additional layer of security. By routing requests through a reverse proxy server, the Content Hub endpoint remains shielded from direct exposure.\nHidden Endpoint and API Token Reverse proxy calls also ensure the concealment of sensitive information, such as the Content Hub endpoint and API token, from client-side code. Rather than making direct requests to the Content Hub API, all requests are directed to the reverse proxy server. This approach minimizes the risk of exposing the endpoint and API token to potential threats, providing heightened protection for sensitive information.\nImplementation To get started, we need to install the “http-proxy-middleware” npm module. Open your terminal and run the following command:\nyarn add http-proxy-middleware Updating the Client File Next, we’ll update the client file “sitecorecloud.ts” with the following code:\nimport { createApolloClient } from 'endless-lib/apollo' const sitecorecloud = createApolloClient({ uri: process.env.APOLLO_SITECORECLOUD_URI ?? '/api/proxy/sitecorecloud', headers: { 'X-GQL-Token': process.env.APOLLO_SITECORECLOUD_TOKEN ?? '', }, }) export default sitecorecloud As you can observe, when executing this call on the server, we direct it to the original endpoint. However, if we’re not on the server, we use the reverse proxy endpoint instead. Additionally, please note that environment variables which don’t begin with “NEXT_PUBLIC_” will not be accessible on the client side.\nMake sure to replace “endless-lib/apollo” with the appropriate import for your specific setup.\nCreating the API Endpoint (Reverse Proxy) Now, let’s create the API endpoint with the following code:\n// File: pages/api/proxy/sitecorecloud/[[...sitecorecloud]].api.ts import type { NextApiRequest, NextApiResponse } from 'next' import { createProxyMiddleware } from 'http-proxy-middleware' const proxy = createProxyMiddleware({ secure: false, changeOrigin: true, target: process.env.APOLLO_SITECORECLOUD_URI, pathRewrite: { '/api/proxy/sitecorecloud': '', }, }) as (req: NextApiRequest, res: NextApiResponse) =\u003e void export const config = { api: { bodyParser: false, externalResolver: true, }, } export default async function handler(req: NextApiRequest, res: NextApiResponse) { const header = 'X-GQL-Token'.toLowerCase() // Since the value of the environment variable is not public // to the client, this header value will be undefined. // Therefore, we set it before sending the request. req.headers[header] = process.env.APOLLO_SITECORECLOUD_TOKEN proxy(req, res) } This file sets up a reverse proxy using the http-proxy-middleware module. It forwards requests to the specified target (“process.env.APOLLO_SITECORECLOUD_URI”) while rewriting the path to remove the proxy part (\"/api/proxy/sitecorecloud\"). The “X-GQL-Token” header is added to the request using the value from the environment variable “APOLLO_SITECORECLOUD_TOKEN”.\nRemember to adjust the code to match your specific environment and requirements.\nConclusion Reverse proxy calls streamline the integration of Sitecore Content Hub with Next.js, enhancing security and simplifying the process.\nThe HTTP Proxy Middleware simplifies the implementation of reverse proxy functionality in Next.js applications by handling low-level configurations. It acts as an intermediary, allowing direct calls to the original endpoint on the back-end while providing security and abstraction for the client-side application.\nBy leveraging reverse proxy calls and the capabilities of Next.js and the HTTP Proxy Middleware, developers can establish a seamless integration between Sitecore Content Hub and Next.js, ensuring secure and optimized content management and delivery.\n","wordCount":"574","inLanguage":"en","datePublished":"2023-05-23T03:47:58-03:00","dateModified":"2023-05-23T03:47:58-03:00","author":{"@type":"Person","name":"André Moraes"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://andrelom.github.io/endless/posts/seamless-integration-of-sitecore-content-hub-with-nextjs-using-reverse-proxy-calls/"},"publisher":{"@type":"Organization","name":"André Moraes","logo":{"@type":"ImageObject","url":"https://andrelom.github.io/endless/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://andrelom.github.io/endless/ accesskey=h title="André Moraes (Alt + H)">André Moraes</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://andrelom.github.io/endless/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://andrelom.github.io/endless/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://andrelom.github.io/endless/archives/ title=Archives><span>Archives</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Seamless Integration of Sitecore Content Hub With Nextjs Using Reverse Proxy Calls</h1><div class=post-description>Reverse proxy calls streamline the integration of Sitecore Content Hub with Next.js, enhancing security and simplifying the process.</div><div class=post-meta><span title='2023-05-23 03:47:58 -0300 -03'>May 23, 2023</span>&nbsp;·&nbsp;André Moraes</div></header><div class=post-content><p>Efficient and secure connections between different platforms are crucial in the ever-evolving web development landscape. One such scenario is integrating Sitecore Content Hub with Next.js applications.</p><p>By utilizing Next.js and implementing reverse proxy calls, developers can optimize communication while safeguarding sensitive information. In this blog post, we&rsquo;ll explore the benefits of reverse proxy calls and how they enhance security and API protection by concealing the Content Hub endpoint and API token.</p><h2 id=benefits-of-reverse-proxy-calls>Benefits of Reverse Proxy Calls<a hidden class=anchor aria-hidden=true href=#benefits-of-reverse-proxy-calls>#</a></h2><p>When integrating Next.js with Sitecore Content Hub, reverse proxy calls offer an additional layer of security. By routing requests through a reverse proxy server, the Content Hub endpoint remains shielded from direct exposure.</p><h3 id=hidden-endpoint-and-api-token>Hidden Endpoint and API Token<a hidden class=anchor aria-hidden=true href=#hidden-endpoint-and-api-token>#</a></h3><p>Reverse proxy calls also ensure the concealment of sensitive information, such as the Content Hub endpoint and API token, from client-side code. Rather than making direct requests to the Content Hub API, all requests are directed to the reverse proxy server. This approach minimizes the risk of exposing the endpoint and API token to potential threats, providing heightened protection for sensitive information.</p><h2 id=implementation>Implementation<a hidden class=anchor aria-hidden=true href=#implementation>#</a></h2><p>To get started, we need to install the &ldquo;http-proxy-middleware&rdquo; npm module. Open your terminal and run the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>yarn add http-proxy-middleware
</span></span></code></pre></div><h3 id=updating-the-client-file>Updating the Client File<a hidden class=anchor aria-hidden=true href=#updating-the-client-file>#</a></h3><p>Next, we&rsquo;ll update the client file &ldquo;sitecorecloud.ts&rdquo; with the following code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>createApolloClient</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;endless-lib/apollo&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>sitecorecloud</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createApolloClient</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>uri</span>: <span style=color:#66d9ef>process.env.APOLLO_SITECORECLOUD_URI</span> <span style=color:#f92672>??</span> <span style=color:#e6db74>&#39;/api/proxy/sitecorecloud&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;X-GQL-Token&#39;</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>APOLLO_SITECORECLOUD_TOKEN</span> <span style=color:#f92672>??</span> <span style=color:#e6db74>&#39;&#39;</span>,
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>sitecorecloud</span>
</span></span></code></pre></div><p>As you can observe, when executing this call on the server, we direct it to the original endpoint. However, if we&rsquo;re not on the server, we use the reverse proxy endpoint instead. Additionally, please note that environment variables which don&rsquo;t begin with &ldquo;NEXT_PUBLIC_&rdquo; will not be accessible on the client side.</p><p>Make sure to replace &ldquo;endless-lib/apollo&rdquo; with the appropriate import for your specific setup.</p><h3 id=creating-the-api-endpoint-reverse-proxy>Creating the API Endpoint (Reverse Proxy)<a hidden class=anchor aria-hidden=true href=#creating-the-api-endpoint-reverse-proxy>#</a></h3><p>Now, let&rsquo;s create the API endpoint with the following code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#75715e>// File: pages/api/proxy/sitecorecloud/[[...sitecorecloud]].api.ts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#66d9ef>type</span> { <span style=color:#a6e22e>NextApiRequest</span>, <span style=color:#a6e22e>NextApiResponse</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;next&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>createProxyMiddleware</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;http-proxy-middleware&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>proxy</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createProxyMiddleware</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>secure</span>: <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>changeOrigin</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>target</span>: <span style=color:#66d9ef>process.env.APOLLO_SITECORECLOUD_URI</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>pathRewrite</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;/api/proxy/sitecorecloud&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span>,
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>}) <span style=color:#66d9ef>as</span> (<span style=color:#a6e22e>req</span>: <span style=color:#66d9ef>NextApiRequest</span>, <span style=color:#a6e22e>res</span>: <span style=color:#66d9ef>NextApiResponse</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>void</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>config</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>api</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>bodyParser</span>: <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>externalResolver</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handler</span>(<span style=color:#a6e22e>req</span>: <span style=color:#66d9ef>NextApiRequest</span>, <span style=color:#a6e22e>res</span>: <span style=color:#66d9ef>NextApiResponse</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>header</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;X-GQL-Token&#39;</span>.<span style=color:#a6e22e>toLowerCase</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Since the value of the environment variable is not public
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// to the client, this header value will be undefined.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// Therefore, we set it before sending the request.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>headers</span>[<span style=color:#a6e22e>header</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>APOLLO_SITECORECLOUD_TOKEN</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>proxy</span>(<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This file sets up a reverse proxy using the http-proxy-middleware module. It forwards requests to the specified target (&ldquo;process.env.APOLLO_SITECORECLOUD_URI&rdquo;) while rewriting the path to remove the proxy part ("/api/proxy/sitecorecloud"). The &ldquo;X-GQL-Token&rdquo; header is added to the request using the value from the environment variable &ldquo;APOLLO_SITECORECLOUD_TOKEN&rdquo;.</p><p>Remember to adjust the code to match your specific environment and requirements.</p><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>Reverse proxy calls streamline the integration of Sitecore Content Hub with Next.js, enhancing security and simplifying the process.</p><p>The HTTP Proxy Middleware simplifies the implementation of reverse proxy functionality in Next.js applications by handling low-level configurations. It acts as an intermediary, allowing direct calls to the original endpoint on the back-end while providing security and abstraction for the client-side application.</p><p>By leveraging reverse proxy calls and the capabilities of Next.js and the HTTP Proxy Middleware, developers can establish a seamless integration between Sitecore Content Hub and Next.js, ensuring secure and optimized content management and delivery.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://andrelom.github.io/endless/tags/sitecore/>Sitecore</a></li><li><a href=https://andrelom.github.io/endless/tags/sitecore-content-hub/>Sitecore Content Hub</a></li><li><a href=https://andrelom.github.io/endless/tags/sitecore-content-hub-one/>Sitecore Content Hub One</a></li><li><a href=https://andrelom.github.io/endless/tags/reverse-proxy/>Reverse Proxy</a></li><li><a href=https://andrelom.github.io/endless/tags/graphql/>GraphQL</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://andrelom.github.io/endless/>André Moraes</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>